## 记忆时间

## 卡片

### 0101. 主题卡 ——

这本书的主题核心，就是最大的反常识卡，并且注意时间脉络。

### 0201. 术语卡 ——

根据反常识，再补充三个证据——就产生三张术语卡。

### 0202. 术语卡 ——

### 0203. 术语卡 ——

### 0301. 人名卡 ——

根据这些证据和案例，找出源头和提出术语的人是谁——产生一张人名卡，并且分析他为什么牛，有哪些作品，生平经历是什么。

### 0401. 金句卡 ——

最后根据他写的非常震撼的话语——产生一张金句卡。

### 0501. 数据信息卡 —— .NET Framework 只支持 C# 7.3 及之前的版本

信息源自「0201 C# 和.NET Core 简介」

.NET Framework（已被.NET Core 3 取代）。

用于编写运行于 Windows 桌面系统和服务器系统的网络应用程序与富客户端应用程序。虽然 Microsoft 会继续支持和维护当前的 4.8 版本以保证现有应用程序的执行，但该框架目前已没有后续的发布计划。Windows 操作系统上预装了 .NET Framework。.NET Framework 支持 C# 7.3 及之前的版本。

1『 .NET Framework 只支持 C# 7.3 及之前的版本，做一张信息数据卡片。（2022-03-27）』—— 已完成

虽然上述框架支持的系统不同，使用场景不同，但它们均发布了相似的 CLR 和 BCL。

我们可以充分利用这种相似性来编写可以跨框架运行的类库，请参见 5.1 节。

本书着眼于 C# 和 CLR 以及 BCL 提供的核心功能，如图 1-2 所示。虽然主要关注 .NET Core 3，但也会涉及部分和 BCL 提供了相似功能的用于 UWP 应用程序的 Windows Runtime 的类型。

### 0601. 任意卡 —— NaN 的使用场景

信息源自「2022011C#8核心技术指南0201.md」

特殊的 float

和 double 值不同于整数类型，浮点类型包含某些特定运算需要特殊对待的值。这些特殊的值是 NaN（Not a Number，非数字）、+∞、-∞和 - 0。float 和 double 类型包含表示 NaN、+∞、-∞值的常量，其他的常量还有 MaxValue、MinValue 以及 Epsilon。例如：

```cs
Console.WriteLine (double.NegativeInfinity);  // -Infinity
```

double 和 float 类型的特殊值的常量表如下：

零除以零或无穷大减去无穷大的结果是 NaN：

```cs
Console.WriteLine ( 0.0 / 0.0);         // NaN

Console.WriteLine ((1.0 / 0.0) − (1.0 / 0.0));  // NaN
```

使用相等比较运算符（==）时，一个 NaN 值永远也不等于其他的值，甚至不等于其他的 NaN 值：

```cs
Console.WriteLine (0.0 / 0.0 == double.NaN);  // False
```

必须使用 float.IsNaN 或 double.IsNaN 方法来判断一个值是否为 NaN：

```cs
Console.WriteLine (double.IsNaN (0.0 / 0.0));  // True
```

但使用 object.Equals 方法时，两个 NaN 值却是相等的：

```cs
Console.WriteLine (object.Equals (0.0 / 0.0, double.NaN));  // True
```

NaN 在表示特殊值时很有用。在 Windows Presentation Foundation（WPF）中，double.NaN 表示值为「自动」（Automatic）。另一种表示方法是使用可空值类型（见第 4 章）；还可以使用一个包含数值类型和一个额外字段的自定义结构体（见第 3 章）。

2『 NaN 的使用场景，做一张任意卡片。（2022-04-05）』—— 已完成

## 译者序

C# 是一门出色的语言，设计时兼顾了面向对象和函数式编程的特点。若你接触过 C++ 或者 Java，那么一定可以快速上手 C#。

C# 富有表现力且吸收了其他语言的经验。它的定义清晰，少有历史包袱。其进化速度之快也是有目共睹的。从 2002 年诞生到如今一共发布了 14 个版本（不包含技术预览版）。如果说这门语言在 21 世纪之初的十六年间都在慢跑的话，那么近几年的发展则是突飞猛进的。这种蓬勃发展主要体现在三个方面：

第一，从语言版本上讲，2017-2020 年这四年间从 6.0 升级到了 9.0 preview，包含六次正式的版本发布，每一次发布均包含明显的语言能力提升。

第二，C# 和 .NET 有着紧密的关系。从平台上讲，微软对 .NET 平台的开放态度前所未有，.NET Core 的发布真正让它的跨平台能力不再停留在理论层面，而其中的持续改进（不论是底层虚拟机层面的改进还是上层 Framework 的改进）让它在各个技术雷达上逐步被主流的技术团队锁定。

第三，国内外云平台对 .NET Core 的支持不断完善。

因此，不论在语言、平台还是云服务方面，C# 和 .NET Core 都展现了强劲的发展势头。实际上除了 .NET Core 之外，用于移动设备开发的 Xamarin 和跨平台的游戏开发工具 Unity 也使用了 C# 作为主要的开发语言。我非常愿意将这样一门用途广泛、富有创造力的语言推荐给各位读者。而本书可谓是学习 C# 语言理想的一站式读物。

本书全方位地介绍了 C# 的语言特性。在内容上，它兼顾了不同层次的读者。对于初学者，本书不论是介绍基本的语法时，还是介绍高级的语言特性时，都采用了讲解和示例结合的方法。从原理到实践，双管齐下，因此阅读门槛并不高。尤其值得一提的是这些范例都可以直接在 LINQPad 工具中运行。充分练习这些范例有助于读者快速掌握 C# 语言的各种实践。而对于编程经验丰富的读者，本书的每一章都详尽而系统，非常适合案头参考。本书对.NET Core 这一目前主流的跨平台.NET 实现进行了详细的介绍。除了充分涵盖常用基础类库外，还对垃圾回收等运行时相关的主题进行了讨论。得益于作者开发 LINQPad 的丰富经验，本书最后一章对 Roslyn 编译服务的讲解系统而完整，是非常难得的参考资料。

本书在上一版《C# 7.0 核心技术指南》的基础上进行了大量的修订。不但将既有的内容和范例全部迁移到了 .NET Core 上，对 C# 8.0 与 .NET Core 3.x 提供的新特性进行了详细的介绍，还在部分示例中专门对编写跨平台运行程序的技巧或陷阱进行了说明。可以说，本书在内容上涵盖了目前 C# 与 .NET Core 最新正式发行版的内容。

最后，感谢本书的作者 Joseph Albahari。他在我翻译本书时给予了热情的帮助。我们就书中的一些技术细节进行了讨论，我将这些内容放在了译注中。感谢机械工业出版社华章公司的编辑们，他们给予了我很多专业的宝贵建议。他们高标准的把关保证了本书的质量。感谢我的家人，她们的支持给予了我不断前行的动力。希望这本书能给大家带来愉快的阅读体验。请进入 C# 的精彩世界吧！

## 前言

C# 8.0 是 Microsoft 对其旗舰编程语言的第七次重大升级，这次升级极大地提高了 C# 语言的功能和灵活性。一方面，它提供了一些高级的抽象，例如查询表达式和异步延续；另一方面，它允许通过自定义值类型和可选的指针结构进行底层的效率优化。

C# 语言特性的增长也极大地加重了我们的学习负担。虽然一些工具如 Microsoft IntelliSense 和在线参考文档可以提供诸多便利，但若要使用它们，仍需要一些现有的概念和知识体系作为支撑。本书以简明统一的方式（而非烦琐冗长的介绍）准确阐释了这些知识。

与之前的五个版本一样，本书也是围绕概念和用例来组织的，因此无论是顺序阅读还是随意浏览都会大有裨益。虽然本书只要求读者具备基本的背景知识，但是它仍然具有一定的深度，因此本书也适合中高级读者阅读。

本书内容涵盖 C# 语言、公共语言运行时（Common Language Runtime，CLR）和.NET Core 核心程序集。我们之所以做出这样的选择是希望为一些难以理解的主题，例如并发、安全性以及访问操作系统功能留出足够的篇幅，而同时又不对内容的深度和可读性造成显著的影响。本书详细标记了 C# 8 的新特性，因此亦可同时作为 C# 7 的参考资料。

### 01. 目标读者

本书主要针对中高级开发人员。本书不要求读者具备 C# 知识，但需要读者具备一定的通用编程经验。对于初学者，本书适合作为教材以外的补充书籍，而非替代编程教材。

本书非常适合与那些着眼于介绍具体应用技术的书籍配合阅读，例如介绍 ASP.NET Core、Windows Presentation Foundation（WPF）和 Universal Windows Platform（UWP）等技术的书籍。因为那些书籍往往会省略语言和.NET Core 方面的内容，而这些内容正是本书的重点。

本书不适合想匆匆浏览每一种.NET 技术的读者阅读，亦不适合关心特定领域（例如移动端设备开发）API 使用方式的读者阅读。

### 02. 本书的结构

本书第 2-4 章将详细介绍 C# 语言。首先介绍最基本的语法、类型和变量。而后会介绍一些高级的特性，如不安全代码以及预处理指令。如果你是 C# 语言的初学者，请循序渐进地阅读这些章节。

其余各章则涵盖了.NET Core 的核心功能，包括语言集成查询（Language-Integrated Query，LINQ）、XML、集合、并发、I/O 和网络、内存管理、反射、动态编程、特性、安全以及原生互操作性等主题。第 5～6 章是后续章节主题的基础，除这两章之外，其余各章可以按照需要以任何顺序阅读。LINQ 相关的三章最好按顺序阅读，其中的部分章节需要一些并发相关的知识，这些知识将在第 14 章中介绍。

### 03. 使用本书所需的其他材料

运行本书中的示例需要.NET Core 3。此外，还可以使用 Microsoft 的.NET 在线文档查找每一个具体类型及成员的信息。

虽然可以在记事本中书写源代码并从命令行中执行编译过程，但是为了提高效率，最好使用一个代码编辑执行工具随时测试各个代码片段并使用集成开发环境（Integrated Development Environment，IDE）来生成可执行文件或程序库。

对于 Windows 操作系统的用户，推荐从 www.linqpad.net

下载免费的 LINQPad 6 作为代码编辑执行工具。LINQPad 完全支持 C# 8.0，且该软件就是由本书的作者之一维护的。

至于 Windows 操作系统下的集成开发环境，建议下载并使用 Microsoft Visual Studio 2019。该工具的任何版本都能够运行本书中的所有示例。如果需要使用跨平台的集成开发环境，则请下载 Visual Studio Code。

LINQPad 中包含了本书中的所有示例代码。这些示例代码均可以再次编辑并交互式运行。如需下载所有的示例代码，请在 LINQPad 底部左侧的「Samples」选项卡中单击「Download more samples」按钮，并选择「C# 8.0 in a Nutshell」。

.NET Core 支持 Windows、Linux 和 macOS。我们在 Ubuntu Linux 18.04 中对部分跨平台特性进行了测试。详细代码请参见 GitHub（https://github.com/ericjohannsen/Nutshell8）。
